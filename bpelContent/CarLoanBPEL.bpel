<!-- CarLoanBPEL BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Fri Mar 31 04:43:53 EDT 2017 -->
<bpel:process name="CarLoanBPEL" targetNamespace="http://carloan"
	suppressJoinFailure="yes" xmlns:tns="http://carloan"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:ns="http://soapwebservice.com/customer" xmlns:ns0="http://creditscoresoapservice.com/soap" xmlns:ns1="http://loansoapservice.com/soap">

	<!-- Import the client WSDL -->
    <bpel:import namespace="http://loansoapservice.com/soap" location="Loans.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import namespace="http://creditscoresoapservice.com/soap" location="CreditScore.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import namespace="http://soapwebservice.com/customer"
		location="CustomerDetails.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
	<bpel:import location="CarLoanBPELArtifacts.wsdl"
		namespace="http://carloan" importType="http://schemas.xmlsoap.org/wsdl/" />

	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="client" partnerLinkType="tns:CarLoanBPEL"
			myRole="CarLoanBPELProvider" />
		<bpel:partnerLink name="CustomerDetailsPL"
			partnerLinkType="tns:CustomerDetailsPLT" partnerRole="CustomerDetailsRole"></bpel:partnerLink>
        <bpel:partnerLink name="CreditScorePL" partnerLinkType="tns:CreditScorePLT" partnerRole="CreditScoreRole"></bpel:partnerLink>
        <bpel:partnerLink name="LoansPL" partnerLinkType="tns:LoansPLT" partnerRole="LoansRole"></bpel:partnerLink>
    </bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->
	<bpel:variables>
		<!-- Reference to the message passed as input during initiation -->
		<bpel:variable name="input" messageType="tns:CarLoanBPELRequestMessage" />

		<!-- Reference to the message that will be returned to the requester -->
		<bpel:variable name="output" messageType="tns:CarLoanBPELResponseMessage" />
		<bpel:variable name="CustomerDetailsPLResponse"
			messageType="ns:getCustomerResponse"></bpel:variable>
		<bpel:variable name="CustomerDetailsPLRequest"
			messageType="ns:getCustomerRequest"></bpel:variable>
        <bpel:variable name="CreditScorePLResponse" messageType="ns0:getCreditScoreResponse"></bpel:variable>
        <bpel:variable name="CreditScorePLRequest" messageType="ns0:getCreditScoreRequest"></bpel:variable>
        <bpel:variable name="LoansPLResponse" messageType="ns1:getLoanResponse"></bpel:variable>
        <bpel:variable name="LoansPLRequest" messageType="ns1:getLoanRequest"></bpel:variable>
    </bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requester. Note: This maps to operation defined 
			in CarLoanBPEL.wsdl -->
		<bpel:receive name="receiveInput" partnerLink="client"
			portType="tns:CarLoanBPEL" operation="process" variable="input"
			createInstance="yes" />
        
        <bpel:assign validate="no" name="AssignInputToCustomerService">
            <bpel:copy>
                <bpel:from><bpel:literal><tns:getCustomerRequest xmlns:tns="http://soapwebservice.com/customer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:customerId>tns:customerId</tns:customerId>
  <tns:carModelYear>0</tns:carModelYear>
  <tns:carManufacturer>tns:carManufacturer</tns:carManufacturer>
</tns:getCustomerRequest>
</bpel:literal></bpel:from>
                <bpel:to variable="CustomerDetailsPLRequest" part="getCustomerRequest"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:customerID]]></bpel:query>
                </bpel:from>
                <bpel:to part="getCustomerRequest" variable="CustomerDetailsPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:customerId]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:carManufacturer]]>
                    </bpel:query>
                </bpel:from>
                <bpel:to part="getCustomerRequest" variable="CustomerDetailsPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns:carManufacturer]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:carYear]]></bpel:query>
                </bpel:from>
                <bpel:to part="getCustomerRequest" variable="CustomerDetailsPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:carModelYear]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        <bpel:invoke name="InvokeCustomerService" partnerLink="CustomerDetailsPL" operation="getCustomer" portType="ns:CustomerPort" inputVariable="CustomerDetailsPLRequest" outputVariable="CustomerDetailsPLResponse"></bpel:invoke>
        
        
        <!-- Generate reply to synchronous request -->
        <bpel:assign validate="no" name="AssignCutomerServiceOuputToInput">
            
            
            
            
            <bpel:copy>
                <bpel:from><bpel:literal><tns:CarLoanBPELResponse xmlns:tns="http://carloan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:creditScore>0</tns:creditScore>
  <tns:firstName>tns:firstName</tns:firstName>
  <tns:ssn>tns:ssn</tns:ssn>
</tns:CarLoanBPELResponse>
</bpel:literal></bpel:from>
                <bpel:to variable="output" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="getCustomerResponse" variable="CustomerDetailsPLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:customer/ns:ssn]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:ssn]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="getCustomerResponse" variable="CustomerDetailsPLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:customer/ns:firstname]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:firstName]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        <bpel:assign validate="no" name="AssignToCreditScore">
            <bpel:copy>
                <bpel:from><bpel:literal><tns:getCreditScoreRequest xmlns:tns="http://creditscoresoapservice.com/soap" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:ssn>tns:ssn</tns:ssn>
  <tns:firstname>tns:firstname</tns:firstname>
  <tns:lastname>tns:lastname</tns:lastname>
</tns:getCreditScoreRequest>
</bpel:literal></bpel:from>
                <bpel:to variable="CreditScorePLRequest" part="getCreditScoreRequest"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:ssn]]></bpel:query>
                </bpel:from>
                <bpel:to part="getCreditScoreRequest" variable="CreditScorePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:ssn]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:firstName]]>
                    </bpel:query>
                </bpel:from>
                <bpel:to part="getCreditScoreRequest" variable="CreditScorePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:firstname]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:firstName]]></bpel:query>
                </bpel:from>
                <bpel:to part="getCreditScoreRequest" variable="CreditScorePLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns0:firstname]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        <bpel:invoke name="InvokeCreditScoreService" partnerLink="CreditScorePL" operation="getCreditScore" portType="ns0:CreditscorePort" inputVariable="CreditScorePLRequest" outputVariable="CreditScorePLResponse"></bpel:invoke>
        <bpel:assign validate="no" name="AssignServiceValueToOutput">
            
        
            
            
            
            <bpel:copy>
                <bpel:from><bpel:literal><tns:CarLoanBPELResponse xmlns:tns="http://carloan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:creditScore>0</tns:creditScore>
  <tns:firstName>tns:firstName</tns:firstName>
</tns:CarLoanBPELResponse>
</bpel:literal></bpel:from>
                <bpel:to variable="output" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="getCreditScoreResponse" variable="CreditScorePLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:creditscore/ns0:creditScore]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:creditScore]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="getCreditScoreResponse" variable="CreditScorePLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns0:creditscore/ns0:firstname]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:firstName]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            
        </bpel:assign>
        <bpel:assign validate="no" name="AssignToLoanService">
            <bpel:copy>
                <bpel:from><bpel:literal><tns:getLoanRequest xmlns:tns="http://loansoapservice.com/soap" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:creditScore>0</tns:creditScore>
  <tns:carManufacturer>tns:carManufacturer</tns:carManufacturer>
  <tns:carModelYear>0</tns:carModelYear>
</tns:getLoanRequest>
</bpel:literal></bpel:from>
                <bpel:to variable="LoansPLRequest" part="getLoanRequest"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:creditScore]]></bpel:query>
                </bpel:from>
                <bpel:to part="getLoanRequest" variable="LoansPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns1:creditScore]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:carManufacturer]]></bpel:query>
                </bpel:from>
                <bpel:to part="getLoanRequest" variable="LoansPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns1:carManufacturer]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:carYear]]></bpel:query>
                </bpel:from>
                <bpel:to part="getLoanRequest" variable="LoansPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns1:carModelYear]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        <bpel:invoke name="InvokeLoanService" partnerLink="LoansPL" operation="getLoan" portType="ns1:LoansPort" inputVariable="LoansPLRequest" outputVariable="LoansPLResponse"></bpel:invoke>
        
        <bpel:assign validate="no" name="AssignLoanToOutput">
            <bpel:copy>
                <bpel:from><bpel:literal><tns:CarLoanBPELResponse xmlns:tns="http://carloan" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:creditScore>0</tns:creditScore>
  <tns:firstName>tns:firstName</tns:firstName>
  <tns:ssn>tns:ssn</tns:ssn>
  <tns:lastName>tns:lastName</tns:lastName>
  <tns:bankAndInterest>
    <tns:bankName>tns:bankName</tns:bankName>
    <tns:interestRate>0.0</tns:interestRate>
  </tns:bankAndInterest>
</tns:CarLoanBPELResponse>
</bpel:literal></bpel:from>
                <bpel:to variable="output" part="payload"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="getLoanResponse" variable="LoansPLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[ns1:loan/ns1:creditScore]]>
                    </bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0">
                        <![CDATA[tns:creditScore]]>
                    </bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="getLoanResponse" variable="LoansPLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns1:loan/ns1:bankAndInterest[1]/ns1:bankName]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:bankAndInterest/tns:bankName]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="getLoanResponse" variable="LoansPLResponse">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns1:loan/ns1:bankAndInterest[1]/ns1:interestRate]]></bpel:query>
                </bpel:from>
                <bpel:to part="payload" variable="output">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:bankAndInterest/tns:interestRate]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        
        
        <bpel:reply name="replyOutput" 
               partnerLink="client"
               portType="tns:CarLoanBPEL"
               operation="process" 
               variable="output"
               />
    </bpel:sequence>
    
</bpel:process>

